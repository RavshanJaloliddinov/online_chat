<!DOCTYPE html>
<html lang="uz">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"
        integrity="sha384-2huaZvOR9iDzHqslqwpR87isEmrfxqyWOF7hr7BY6KG0+hVKLoEXMPUJw3ynWuhO" crossorigin="anonymous">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <title>WebSocket Chat</title>

    <style>
        /* Main chat container */
        .chat-container {
            border: 1px solid black;
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 15px;
        }

        /* Chat messages box */
        #chat-box {
            border: 1px solid black;
            height: 65vh;
            overflow-y: scroll;
            padding: 10px;
            background-color: #ffffff;
        }

        #no-messages-box{
            border: 1px solid black;
            height: 65vh;
            overflow-y: scroll;
            padding: 10px;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Typing status text */
        #typing-status {
            font-style: italic;
            color: #6c757d;
            text-align: center;
        }

        /* Input and send button */
        #message-input {
            margin-top: 10px;
        }

        #message-input input {
            width: 80%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
        }

        #message-input button {
            width: 18%;
            margin-left: 2%;
            padding: 10px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 5px;
        }

        #message-input button:hover {
            background-color: #0056b3;
        }
    </style>
</head>

<body>
    <div class="container-fluid bg-danger mx-auto p-0 m-0 d-flex align-items-center justify-content-center" style="height: 100vh;">
        <div class="container chat-container">
      
            <div class="container row mx-auto p-1 m-1 d-flex align-items-center justify-content-between" id="header-chat" style="margin-bottom: 10px;">
                <div class="col-xxl-3 col-md-12 col-sm-12 col-lg-12">
                    <select class="form-select form-select-sm">
                        <option selected>Select a Group</option>
                        <option value="group1">Group 1</option>
                        <option value="group2">Group 2</option>
                        <option value="group3">Group 3</option>
                    </select>
                </div>

                
                <div class="col-xxl-5 col-xl-3 col-md-12 col-sm-12 col-lg-12 d-flex gap-2" style="margin: 10px 0px; display: flex; align-items: center; justify-content: center;" >
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-gear-fill"></i> Settings
                    </button>
                    <button class="btn btn-sm btn-outline-success">
                        <i class="bi bi-person-plus-fill"></i> Add User
                    </button>
                    <button class="btn btn-sm btn-outline-danger">
                        <i class="bi bi-box-arrow-right"></i> Leave Group
                    </button>
                    <button class="btn btn-sm btn-outline-warning">
                        <i class="bi bi-patch-plus-fill"></i> New group
                    </button>
                </div>

                <div class="col-xxl-3 p-0 m-0 d-flex align-items-center justify-content-center col-md-12 col-sm-12 col-lg-12">
                    <p id="typing-status">john, carlo, sara... is typing</p>
                </div>
            </div>

     
            <div id="chat-box">
              
            </div>

            <div id="no-messages-box">
                <h3>Currently not connected to any groups</h3>
            </div>

            <div class="container row" id="message-input">
                <input type="text" placeholder="Type a message...">
                <button>Send</button>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
    </script>

    <script>

        const messageInput = document.getElementById("message-input")
        const chatBox = document.getElementById("chat-box")
        const noMessageBox = document.getElementById("no-messages-box")
        if(!localStorage.getItem("groupId")){
            messageInput.style.display = "none"
            chatBox.style.display = "none"
            noMessageBox.style.display = "flex"
        }
        if(localStorage.getItem("groupId")){
            messageInput.style.display = "flex"
            chatBox.style.display = "flex"
            noMessageBox.style.display = "none"
        }
      
        document.querySelector('.btn-outline-warning').addEventListener('click', function () {
            Swal.fire({
                title: 'Create New Group',
                input: 'text',
                inputLabel: 'Group Name',
                inputPlaceholder: 'Enter group name',
                showCancelButton: true,
                confirmButtonText: 'Create',
                preConfirm: (groupName) => {
                    if (!groupName) {
                        Swal.showValidationMessage('Group name is required');
                        return;
                    }
                    if(!localStorage.getItem('userId')){
                        Swal.showValidationMessage('You do not have permission to perform this action')
                    }
                    return fetch('http://127.0.0.1:8080/group', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'accept': '*/*'
                        },
                        body: JSON.stringify({
                            image: 'image.jpg',
                            name: groupName,
                            description: `${groupName} uchun guruh`,
                            link: `${groupName.replace(/\s+/g, '_').toLowerCase()}_group`,
                            group_admin: localStorage.getItem("userId")
                            
                        })
                    }).then(response => {
                        if (response.status === 201) {
                            return { groupName };
                        } else {
                            throw new Error('Group creation failed');
                        }
                    }).catch(error => {
                        Swal.showValidationMessage(`Request failed: ${error}`);
                        console.log(error);
                    });
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    Swal.fire('Group Created', `The group "${result.value.groupName}" has been created!`, 'success');
                }
            });
        });
    </script>
    
    
    

</body>

</html>
